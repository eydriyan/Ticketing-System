<!-- <div>
  <div>
    <button (click)="logout()">Log Out</button>
    <button (click)="toggleFilterForm()">Filter</button>
  </div> -->  
  
<!-- ticket info summary   -->
<!-- <div class="ticket-container">
  <div *ngFor="let ticket of tickets" class="ticket-summary">
    <p><strong>Priority:</strong> {{ ticket.priority }}</p>
    <p><strong>Category:</strong> {{ ticket.category }}</p>
    <p><strong>Status:</strong> {{ ticket.status }}</p>
    <p><strong>Date Created:</strong> {{ ticket.dateCreated }}</p>
    <p><strong>Technician:</strong> {{ ticket.technician }}</p>
    <button (click)="showTicketDetails(ticket)">View Details</button>
  </div>
</div> -->

  <!-- OLD add ticket popup -->
  <!-- for testing purposes only, use mo ung bagong add ticket pop up 
  <div *ngIf="showaddticketForm" class="window-popup">
    <div class="modal-content">
      <span class="close" (click)="toggleaddticketForm()">&times;</span>
      <form (ngSubmit)="addTicket()">
        <h2>Support Ticket Form</h2>
        <p>Create a new ticket for your issue.</p>
        <label for="category">Category:</label>
        <input type="text" id="category" [(ngModel)]="category" name="category" required><br><br>
        <label for="title">Title:</label>
        <input type="text" id="title" [(ngModel)]="title" name="title" required><br><br>
        <label for="description">Description:</label>
        <textarea id="description" [(ngModel)]="description" name="description" required></textarea><br><br>
        <label for="priority">Priority:</label>
        <select id="priority" [(ngModel)]="priority" name="priority" required>
          <option value="priority">Select Priority</option>
          <option value="High">High</option>
          <option value="Medium">Medium</option>
          <option value="Low">Low</option>
        </select><br><br>
        <button type="submit">Submit</button>
      </form>
    </div>
  </div>-->
  
<!-- OLD ticket details popup -->
<!-- for testing purposes only, use mo ung bagong details ticket pop up -->
<!-- <div *ngIf="selectedTicket" class="window-popup">
  <span class="close-btn" (click)="closeTicketDetails()">&times;</span>
  <div class="modal-content">
    <h2>Ticket Details</h2>
    <p><strong>Date Created:</strong> {{ selectedTicket.dateCreated }}</p>
    <p><strong>Category:</strong> {{ selectedTicket.category }}</p>
    <p><strong>Priority:</strong> {{ selectedTicket.priority }}</p>
    <p><strong>Technician:</strong> {{ selectedTicket.technician }}</p>
    <p><strong>Status:</strong> {{ selectedTicket.status }}</p>
    <p><strong>Description:</strong> {{ selectedTicket.description }}</p>
  </div>
</div> -->

<!-- OLD filter form popup -->
<!-- OLD filter form popup 
<div *ngIf="showFilterForm" class="window-popup">
  <div class="modal-content">
    <span class="close" (click)="toggleFilterForm()">&times;</span>
    <h2>Filter Tickets</h2>
    <form (ngSubmit)="applyFilter()">
      <label for="filter-category">Category:</label>
      <input type="text" id="filter-category" [(ngModel)]="filterCategory" name="filter-category"><br><br>
      <label for="filter-priority">Priority:</label>
      <input type="text" id="filter-priority" [(ngModel)]="filterPriority" name="filter-priority"><br><br>
      <label for="filter-date">Date Created:</label>
      <input type="date" id="filter-date" [(ngModel)]="filterDate" name="filter-date"><br><br>
      <label for="filter-status">Status:</label>
      <input type="text" id="filter-status" [(ngModel)]="filterStatus" name="filter-status"><br><br>
      <label for="filter-technician">Technician:</label>
      <input type="text" id="filter-technician" [(ngModel)]="filterTechnician" name="filter-technician"><br><br>
      <button type="submit">Apply Filter</button>
    </form>
  </div>
</div>-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Ticketing System</title>
	  <link href='https://fonts.googleapis.com/css?family=Jomhuria' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <link href="userview.component.css" rel="stylesheet">
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
      <img src="../../assets/images/systemicon.png" alt="systemIcon" class="Ticketing System Icon">
      <div class="title">IT Ticketing System</div>
      <div class="buttons">
          <a href=""><img src="../../assets/images/bellIcon.png" class="bellIcon" alt="Bell Icon"></a>
          <a href=""><img src="../../assets/images/exitIcon.png" class="exitIcon" alt="Exit Icon"></a>
          <a href=""><img src="../../assets/images/userImage.png" class="userImage" alt="User Icon"></a>
      </div>
  </nav>
  
  <!-- (logo)All Tickets(Title) - (Buttton)AddTicket - (Button)Filter - (Searchbar)-->
  <table class="rightcontainer">
      <tr>
          <td class="title-container">
              <img src="../../assets/images/allTickets.png" alt="All Tickets" class="allTickets">
          </td>
          <td class="filter-container">
            <!-- <a href="#" (click)="toggleaddticketForm()">
              <img src="../../assets/images/addTicketButton.png" class="addTicketButton" alt="Add a Ticket">
            </a> -->
            <button class="invisible-button modal-buttons"  (click)="displayModal('ticket-form-container')" data-modal="ticket-form-container">
              <img src="../../assets/images/addTicketButton.png" alt="addTicket">
            </button>
              <!-- <button (click)="toggleaddticketForm()">
              <img src="../../assets/images/addTicketButton.png">
            </button> -->
          </td>
          <!-- <td class="filter-container">
              <a href="toggleFilterForm()"><img src="../../assets/images/filterButton.png" class="filterButton" alt="Filter"></a>
          </td> -->
          <td>
            <button class="invisible-button modal-buttons" (click)="displayModal('Filter-form-container')" data-modal="Filter-form-container">
              <img src="../../assets/images/filterButton.png" class="filterButton" alt="Filter">
            </button>
          </td>
          <td class="search-container">
            <input type="text" id="search"  style="width: 300px; height: 50px;">
            <button class="search-button red-button">Search</button>
          </td>
      </tr>
  </table>
  
<!--Add a Ticket Form as a modal window
<div id="ticket-form-container" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h1 class="form-title">Ticket Details</h1>
    <h4>Comprehensive information about the ticket.</h4>
    <form class="form"(ngSubmit)="addTicket()">
      <div class="form-row">
        <div class="form-col">
          <label class="form-label" for="subject">Subject:</label>
          <input class="form-input" type="text" id="subject" name="subject" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-col">
          <label class="form-label" for="category">Category:</label>
          <select class="form-select" id="category" name="category" required [(ngModel)]="category">
            <option value="PC Malfunction">PC Malfunction</option>
            <option value="Printer Issue">Printer Issue</option>
            <option value="Network Problem">Network Problem</option>
          </select>
        </div>
        <div class="form-col">
          <label class="form-label" for="priority">Priority:</label>
          <select class="form-select" id="priority" name="priority" required [(ngModel)]="priority">
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-col">
          <label class="form-label" for="description">Description:</label>
          <textarea class="form-textarea" id="description" name="description" required [(ngModel)]="description"></textarea>
        </div>
      </div>
      <button class="form-button" type="submit">Add Ticket</button>
    </form>
  </div>
</div>-->

<!--Updated Add Ticket Form only with subject(select), date(automatic) and description-->
<div *ngIf="showaddticketForm" id="ticket-form-container" class="modal"  (click)="closeOnOutsideClick($event, 'ticket-form-container')">
  <div class="modal-content" (click)="$event.stopPropagation()">
      <span class="close" (click)="closeModal('ticket-form-container')">&times;</span>
      <h1 class="form-title">Support Ticket Form</h1>
      <h4 class="form-title2">Create a new ticket for your issue.</h4>
      <form class="form" action="/submit_ticket.php" method="post">
              <div class="form-row">
                  <label class="form-label" for="subject">Subject:</label>
                  <select class="form-select" id="subject" name="subject" required>
                      <option value="select subject">Select Subject:</option>
                      <option value="Account Lockout">Blackboard Account failed log-in</option>
                      <option value="Account Lockout">Mymapua Account failed log-in</option>
                      <option value="Network Problem">Wi-fi Connectivity Problem</option>
                      <option value="Network Security">Network Security Concern</option>
                      <option value="E-mail">E-mail: Spam Filtering</option>
                      <option value="E-mail">E-mail: Security</option>
                      <option value="School Computer">PC Malfunctioning</option>
                      <option value="School Computer">Keyboard not working</option>
                      <option value="School Computer">Monitor not turning on</option>
                  </select>
              </div>
              <div class="form-row">
                <div class="form-col">
                <label class="form-label" for="category">Category:</label>
                <select class="form-select" id="category" name="category" required>
                  <option value="select category">Select Category:</option>
                          <option value="Account Lockout">Account Lockout</option>
                          <option value="Account Lockout">Network Problem</option>
                          <option value="Network Problem">Network Security Issue</option>
                          <option value="Network Security">Hardware Issue</option>
                </select>
                </div>
                <div class="form-col">
                <label class="form-label" for="other">If Other:</label>
                <input class="form-input" type="input" id="other" name="other" required>
                </div>
              </div>
              <div class="form-col">
                <label class="form-label" for="priority">Priority:</label>
                <select class="form-select" id="priority" name="priority" required>
                  <option value="select subject">Select Priority:</option>
                  <option value="Low">Low</option>
                  <option value="Medium">Medium</option>
                  <option value="High">High</option>
                </select>
              </div>
            <div class="form-row">
                  <label class="form-label" for="description">Description:</label>
                  <textarea class="form-textarea" id="description" name="description" required></textarea>
          </div>
          <button class="submit-button" type="submit">Submit Request</button>
          <button class="cancel-button" type="cancel" (click)="closeModal('ticket-form-container')">Cancel</button>
</form>
  </div>
</div>

<!--Updated Filter Form-->
<div *ngIf="showFilterModal" id="Filter-form-container" class="modal"  (click)="closeOnOutsideClick($event, 'Filter-form-container')">
  <div class="modal-content" (click)="$event.stopPropagation()">
      <span #filterModalContent class="close" (click)="closeModal('Filter-form-container')">&times;</span>
      <h1 class="form-title">Filter Tickets</h1>
      <h4 class="form-title2">Find the exact tickets you need quickly.</h4>
      <form class="form" action="/submit_ticket.php" method="post">
          <div class="form-row">
      <div class="form-col">
        <label class="form-label" for="category">Category:</label>
        <select class="form-select" id="category" name="category" required>
          <option value="select category">Select Category:</option>
                  <option value="Account Lockout">Account Lockout</option>
                  <option value="Account Lockout">Network Problem</option>
                  <option value="Network Problem">Network Security Issue</option>
                  <option value="Network Security">Hardware Issue</option>
        </select>
      </div>
      <div class="form-col">
      <label class="form-label" for="priority">Priority:</label>
      <select class="form-select" id="priority" name="priority" required>
        <option value="select subject">Select Priority:</option>
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
      </select>
      </div>
    </div>
          <div class="form-row">
      <div class="form-col">
        <label class="form-label" for="date-created">Date Created:</label>
        <input class="form-input" type="date" id="date-created" name="date-created">    
      </div>
      <div class="form-col">
        <label class="form-label" for="status">Status:</label>
        <select class="form-select" id="status" name="status" required>
            <option value="status type:">Select status:</option>
            <option value="On Hold">On Hold</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Resolved">Resolved</option>
        </select>
      </div>
    </div>
          <button class="submit-button" type="submit">Filter Tickets</button>
          <button class="cancel-button" type="button" (click)="closeModal('Filter-form-container')">Cancel</button>
      </form>
  </div>
</div>

<!--Updated Ticket Details-->
    <!--Ticket Details-->
		<div *ngIf="showTicketDetailsModal" (click)="closeOnOutsideClick($event, 'ticket-details-container')" id="ticket-details-container" class="modal">
      <div class="modal-content"  (click)="$event.stopPropagation()">
          <span class="close"  (click)="closeModal('ticket-details-container')">&times;</span>
          <h1 class="form-title">Ticket Details</h1>
          <h4 class="form-title2">Comprehensive information about the ticket.</h4>
          <form class="form" action="/submit_ticket.php" method="post">
      <div class="form-row">
          <div class="form-col">
            <label class="form-label" for="subject">Subject:</label>
            <input class="form-input" type="text" id="subject" name="subject" readonly>
          </div>
          <div class="form-col">
            <label class="form-label" for="date-created">Date Created:</label>
            <input class="form-input" type="date" id="date-created" name="date-created" readonly>    
          </div>
        </div>
              <div class="form-row">
          <div class="form-col">
          <label class="form-label" for="category">Category:</label>
           <input class="form-input" type="text" id="category" name="category" readonly>
          </div>
          <div class="form-col">
          <label class="form-label" for="priority">Priority:</label>
          <input class="form-input" type="text" id="priority" name="priority" readonly>
          </div>
        </div>
              <div class="form-row">
          <div class="form-col">
          <label class="form-label" for="technician">Technician:</label>
           <input class="form-input" type="text" id="technician" name="technician" readonly>
          </div>
          <div class="form-col">
          <label class="form-label" for="status">Status:</label>
          <input class="form-input" type="text" id="status" name="status" readonly>
          </div>
        </div>
        <div class="form-row">
          <label class="form-label" for="description">Description:</label>
          <textarea class="form-textarea" id="description" name="description" readonly></textarea>
      </div>
          </form>
      </div>
  </div>
  
  <!--Left Container for Profile, Dashboard and History-->
  <div class="leftcontainer">
      <div class="profile-container">
          <img src="../../assets/images/tempprofile.png" alt="Profile" class="tempprofile">
          <div class="userdata">
              <h4>Adrian Oraya</h4>
              <h4>Student</h4>
          </div>
      </div>
      <div class="line-division"></div>
      <div class="buttons-nav">
          <a href="/user"><img src="../../assets/images/dashboardButton.png" class="dashboard" alt="Dashboard"></a>
          <a href="/userhistory"><img src="../../assets/images/historyButton.png" class="history" alt="History"></a>
      </div>
  </div>
  
  <!-- table for tickets-->
  <div class="cont-tickets">
    <table>
      <tr>
        <th class="color-priority"></th>
        <th>Priority</th>
        <th>Category</th>
        <th>Status</th>
        <th>Date Created</th>
        <th>Technician</th>
        <th></th>
      </tr>
    </table>
    <table class="tickets">
      <tr *ngFor="let ticket of tickets" (click)="displayModal('ticket-details-container')" data-modal="ticket-details-container" class="modal-buttons">
        <td [ngClass]="getPriorityColor(ticket.priority)"></td>
        <td class="priority">{{ ticket.priority }}</td>
        <td>{{ ticket.category }}</td>
        <td>{{ ticket.status }}</td>
        <td>{{ ticket.dateCreated }}</td>
        <td>{{ ticket.technician.email }}</td>
        <td>
          <button class="vertical-ellipsis-button"  (click)="displayUpdateModal($event)">
            <span class="ellipsis">...</span>
          </button>
          <!-- <button (click)="showTicketDetails(ticket)">View Details</button> -->
        </td>
      </tr>
    </table>
  </div>

  <!--footer-->
  <div class="footer">
      <p>Copyright © 2024</p>
  </div>


  <!-- <script>
	// Function to display the modal

	// var buttonTicket = document.querySelectorAll('.modal-buttons');

	// buttonTicket.forEach(function(btn) {
	// 	btn.addEventListener('click', function() {
	// 	var modalId = this.getAttribute('data-modal');
	// 	displayModal(modalId);
	// 	});
	// });

	// function displayModal(modalId) {
	// 	var modals = document.querySelectorAll('.modal');
	// 	modals.forEach(function(modal) {
	// 		modal.style.display = "none";
	// 	});
	// 	var modal = document.getElementById(modalId);
	// 	if (modal) {
	// 		modal.style.display = "block";
	// 	}
	// }

	// Function to close the Add Ticket Form modal
	function closeModal() {
		var modal = document.getElementById('update-form-container');
		if (modal) {
			modal.style.display = "none";
		}
	}

	// Function to close the Filter Form modal
	function closeFilterModal() {
		var modal = document.getElementById('Filter-form-container');
		if (modal) {
			modal.style.display = "none";
		}
	}

	// // When the user clicks anywhere outside of the modal, close it
	// window.onclick = function(event) {
	// 	var modals = document.querySelectorAll('.modal');
	// 	modals.forEach(function(modal) {
	// 		if (event.target == modal) {
	// 			modal.style.display = "none";
	// 		}
	// 	});
	// }
	
// Function to display the correct modal based on the clicked element
document.addEventListener("DOMContentLoaded", function() {
    // Attach event listeners to all elements marked to trigger modals
    var modalTriggers = document.querySelectorAll('.modal-buttons');

    modalTriggers.forEach(function(trigger) {
        trigger.addEventListener('click', function(event) {
            event.stopPropagation(); // Prevents the event from bubbling up the event chain
            var modalId = this.getAttribute('data-modal');
            displayModal(modalId);
        });
    });

    function displayModal(modalId) {
        var modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'block';
        } else {
            console.error('No modal found with ID:', modalId);
        }
    }

    // Attach event listeners to close buttons within modals
    document.querySelectorAll('.modal .close').forEach(function(closeButton) {
        closeButton.addEventListener('click', function() {
            var modal = this.closest('.modal');
            if (modal) {
                modal.style.display = 'none';
            }
        });
    });


    // Optionally, add a listener for clicking outside the modal to close it
    document.querySelectorAll('.modal').forEach(function(modal) {
        modal.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
});
  </script>


<script>
  // JavaScript to set the current date in the "Date Created" input field
  document.addEventListener("DOMContentLoaded", function() {
      var currentDate = new Date().toISOString().split('T')[0];
      document.getElementById('date-created').value = currentDate;
  });
</script>

< For Filter Ticket
<script>
  function getCurrentDate(offset) {
      const currentDate = new Date();
      const year = currentDate.getFullYear() + (parseInt(offset) || 0);
      const month = String(currentDate.getMonth() + 1).padStart(2, '0');
      const day = String(currentDate.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
  }

  document.addEventListener("DOMContentLoaded", function() {
      const dateInput = document.getElementById('date-created');
      dateInput.value = getCurrentDate();
  }); 
</script> -->

  </body>
</html>
